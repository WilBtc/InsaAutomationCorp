# Log Rotation Configuration for INSA Advanced IIoT Platform
# Version: 2.0
# Updated: October 28, 2025
#
# INSTALLATION:
# sudo cp logrotate.conf /etc/logrotate.d/insa-iiot
# sudo chown root:root /etc/logrotate.d/insa-iiot
# sudo chmod 644 /etc/logrotate.d/insa-iiot
#
# TEST:
# sudo logrotate -d /etc/logrotate.d/insa-iiot

# Main application log
/tmp/insa-iiot-advanced.log {
    # Rotate daily
    daily

    # Keep 7 days of logs
    rotate 7

    # Compress old logs
    compress

    # Delay compression until next rotation
    delaycompress

    # Don't rotate empty logs
    notifempty

    # Don't error if log is missing
    missingok

    # Create new log file with these permissions
    create 0644 wil wil

    # Actions after rotation
    postrotate
        # Send HUP signal to application to reopen log file
        # pkill -HUP -f app_advanced.py 2>/dev/null || true
    endscript

    # Use date as extension instead of number
    dateext
    dateformat -%Y%m%d

    # Maximum age before deletion (30 days)
    maxage 30
}

# Test logs
/tmp/pytest-*.log {
    # Rotate weekly
    weekly

    # Keep 4 weeks of test logs
    rotate 4

    # Compress old logs
    compress

    # Delay compression
    delaycompress

    # Don't rotate empty logs
    notifempty

    # Don't error if log is missing
    missingok

    # Use date as extension
    dateext
}

# Coverage reports (optional)
/home/wil/iot-portal/htmlcov/*.log {
    weekly
    rotate 2
    compress
    notifempty
    missingok
}
