# Prometheus Configuration for INSA CRM Platform
# Monitors: Multi-agent system, cache, message bus, workers, error handling
# Created: October 28, 2025

global:
  scrape_interval: 15s      # Scrape metrics every 15 seconds
  evaluation_interval: 15s  # Evaluate rules every 15 seconds
  scrape_timeout: 10s       # Timeout after 10 seconds

  # External labels for all metrics
  external_labels:
    cluster: 'insa_crm'
    environment: 'production'
    region: 'iac1'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - 'localhost:9093'  # Alertmanager on port 9093
      timeout: 10s
      api_version: v2

# Load alert rules
rule_files:
  - "prometheus_alerts.yml"  # Alert rules file

# Scrape configurations
scrape_configs:
  # INSA CRM Platform Metrics
  - job_name: 'insa_crm_agents'
    static_configs:
      - targets: ['100.100.101.1:9091']  # Metrics server port
        labels:
          service: 'multi_agent_system'
          component: 'orchestrator'

    # Scrape interval override (optional)
    scrape_interval: 15s
    scrape_timeout: 10s

    # Metric relabeling (optional)
    metric_relabel_configs:
      # Drop metrics we don't need (example)
      - source_labels: [__name__]
        regex: 'go_.*'
        action: drop

  # Optional: Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # Optional: Node Exporter (system metrics)
  # - job_name: 'node_exporter'
  #   static_configs:
  #     - targets: ['100.100.101.1:9100']
  #       labels:
  #         service: 'system_metrics'

# Storage configuration
storage:
  tsdb:
    path: /var/lib/prometheus/data
    retention:
      time: 15d  # Keep metrics for 15 days
      size: 10GB  # Maximum storage size

# Optional: Remote write (for long-term storage)
# remote_write:
#   - url: "http://remote-storage:9009/write"

# Optional: Remote read (for querying long-term storage)
# remote_read:
#   - url: "http://remote-storage:9009/read"
