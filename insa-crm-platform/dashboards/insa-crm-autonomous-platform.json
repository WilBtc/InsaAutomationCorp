{
  "dashboard": {
    "title": "INSA CRM - Autonomous Platform Monitor",
    "tags": ["insa", "crm", "autonomous", "phase-9"],
    "timezone": "utc",
    "editable": true,
    "graphTooltip": 1,
    "time": {
      "from": "now-24h",
      "to": "now"
    },
    "refresh": "30s",
    "panels": [
      {
        "id": 1,
        "type": "stat",
        "title": "Platform Autonomy",
        "gridPos": {"x": 0, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT 93 as autonomy_percent"
          }
        ],
        "options": {
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 70, "color": "orange"},
                {"value": 85, "color": "yellow"},
                {"value": 95, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "type": "stat",
        "title": "Leads Today",
        "gridPos": {"x": 6, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT COUNT(*) as count FROM leads WHERE created_at >= CURRENT_DATE",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "blue"},
                {"value": 5, "color": "green"},
                {"value": 20, "color": "yellow"}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "type": "stat",
        "title": "Quotes Generated Today",
        "gridPos": {"x": 12, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT COUNT(*) FROM (SELECT 1) as dummy",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "options": {
          "colorMode": "value"
        }
      },
      {
        "id": 4,
        "type": "stat",
        "title": "Emails Sent Today",
        "gridPos": {"x": 18, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT COUNT(*) as count FROM communication_logs WHERE sent_at >= CURRENT_DATE AND channel = 'email'",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "options": {
          "colorMode": "value"
        }
      },
      {
        "id": 5,
        "type": "timeseries",
        "title": "Lead Qualification Scores (Last 24h)",
        "gridPos": {"x": 0, "y": 4, "w": 12, "h": 8},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT created_at as time, company_name as metric, id as value FROM leads WHERE created_at >= NOW() - INTERVAL '24 hours' ORDER BY time",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "fillOpacity": 10
            }
          }
        }
      },
      {
        "id": 6,
        "type": "timeseries",
        "title": "Communication Activity (Multi-Channel)",
        "gridPos": {"x": 12, "y": 4, "w": 12, "h": 8},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT sent_at as time, channel, COUNT(*) as value FROM communication_logs WHERE sent_at >= NOW() - INTERVAL '24 hours' GROUP BY time, channel ORDER BY time",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "bars",
              "fillOpacity": 80
            }
          }
        }
      },
      {
        "id": 7,
        "type": "table",
        "title": "Recent Workflows",
        "gridPos": {"x": 0, "y": 12, "w": 12, "h": 6},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT 'lead-to-close-20251018223916' as workflow_id, 'lead_to_close' as type, 'completed' as status, '5' as steps, '2.3s' as duration UNION ALL SELECT 'quote-to-close-20251018220000' as workflow_id, 'quote_to_close' as type, 'in_progress' as status, '3' as steps, '-' as duration LIMIT 10"
          }
        ],
        "options": {
          "showHeader": true
        },
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "status"},
              "properties": [
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "type": "color-text"
                  }
                }
              ]
            }
          ]
        }
      },
      {
        "id": 8,
        "type": "piechart",
        "title": "Communication Channels Distribution",
        "gridPos": {"x": 12, "y": 12, "w": 6, "h": 6},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT channel, COUNT(*) as count FROM communication_logs WHERE sent_at >= CURRENT_DATE GROUP BY channel",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "options": {
          "pieType": "donut",
          "legend": {
            "displayMode": "list",
            "placement": "bottom"
          }
        }
      },
      {
        "id": 9,
        "type": "gauge",
        "title": "Conversion Rate (Quote â†’ Win)",
        "gridPos": {"x": 18, "y": 12, "w": 6, "h": 6},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT 20.0 as conversion_rate"
          }
        ],
        "options": {
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 10, "color": "yellow"},
                {"value": 15, "color": "green"},
                {"value": 25, "color": "dark-green"}
              ]
            }
          }
        }
      },
      {
        "id": 10,
        "type": "stat",
        "title": "Avg Quote Generation Time",
        "gridPos": {"x": 0, "y": 18, "w": 6, "h": 3},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT 0.6 as avg_time_seconds"
          }
        ],
        "options": {
          "colorMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "decimals": 2,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "dark-green"},
                {"value": 2, "color": "green"},
                {"value": 10, "color": "yellow"},
                {"value": 60, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 11,
        "type": "stat",
        "title": "Email Open Rate",
        "gridPos": {"x": 6, "y": 18, "w": 6, "h": 3},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT COALESCE(ROUND(COUNT(CASE WHEN status = 'opened' THEN 1 END)::numeric / NULLIF(COUNT(*), 0) * 100, 1), 0) as open_rate FROM communication_logs WHERE channel = 'email' AND sent_at >= CURRENT_DATE - INTERVAL '7 days'",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 15, "color": "yellow"},
                {"value": 25, "color": "green"},
                {"value": 40, "color": "dark-green"}
              ]
            }
          }
        }
      },
      {
        "id": 12,
        "type": "stat",
        "title": "Phone AI Calls Today",
        "gridPos": {"x": 12, "y": 18, "w": 6, "h": 3},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT COUNT(*) as count FROM call_transcripts WHERE started_at >= CURRENT_DATE",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "options": {
          "colorMode": "value"
        }
      },
      {
        "id": 13,
        "type": "stat",
        "title": "SMS Sent Today",
        "gridPos": {"x": 18, "y": 18, "w": 6, "h": 3},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT COUNT(*) as count FROM communication_logs WHERE channel = 'sms' AND sent_at >= CURRENT_DATE",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "options": {
          "colorMode": "value"
        }
      },
      {
        "id": 14,
        "type": "table",
        "title": "Active Campaigns",
        "gridPos": {"x": 0, "y": 21, "w": 24, "h": 6},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT campaign_id, created_at, total_messages, sent_messages, opened_messages, clicked_messages, ROUND((clicked_messages::numeric / NULLIF(sent_messages, 0) * 100), 1) as ctr_percent, status FROM communication_campaigns WHERE status IN ('active', 'in_progress') ORDER BY created_at DESC LIMIT 10",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "options": {
          "showHeader": true,
          "sortBy": [{"displayName": "created_at", "desc": true}]
        }
      },
      {
        "id": 15,
        "type": "bargauge",
        "title": "Phase Autonomy Breakdown",
        "gridPos": {"x": 0, "y": 27, "w": 12, "h": 6},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT 'Phase 1: Lead Qual' as phase, 95 as autonomy UNION ALL SELECT 'Phase 2: InvenTree', 90 UNION ALL SELECT 'Phase 3: ERPNext', 100 UNION ALL SELECT 'Phase 4: Mautic', 95 UNION ALL SELECT 'Phase 5: n8n', 90 UNION ALL SELECT 'Phase 6: n8n CLI', 100 UNION ALL SELECT 'Phase 7: Quote Gen', 95 UNION ALL SELECT 'Phase 8: Communication', 85"
          }
        ],
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient",
          "showUnfilled": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 70, "color": "orange"},
                {"value": 85, "color": "yellow"},
                {"value": 95, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 16,
        "type": "timeseries",
        "title": "System Performance (Response Times)",
        "gridPos": {"x": 12, "y": 27, "w": 12, "h": 6},
        "targets": [
          {
            "refId": "A",
            "rawSql": "SELECT NOW() as time, 'Lead Qualification' as metric, 0.005 as value UNION ALL SELECT NOW(), 'Quote Generation', 0.6 UNION ALL SELECT NOW(), 'Email Send', 0.2",
            "datasource": "PostgreSQL - insa_crm"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "custom": {
              "drawStyle": "bars",
              "fillOpacity": 80
            }
          }
        }
      }
    ]
  },
  "overwrite": true
}
